---
title: "git - Modellentwicklung"
author: "Clemens Schmid"
date: "6. Februar 2016"
fontsize: 8pt
output:
  beamer_presentation:
    toc: true
    theme: "metropolis"
    pandoc_args: [
      "--highlight-style=tango"
    ]
fig_caption: yes
---

# Ausgangssituation

## Ausgangssituation

Wir befinden uns in einem Subverzeichnis *nnmodel* im von git überwachten Verzeichnis *somethings*.

```{r, engine = 'bash', eval = FALSE}
[clemens@clemens_asus nnmodel]$ pwd
/home/clemens/Rstats/somethings/nnmodel
```

**git status** ermöglicht es uns, den aktuellen Zustand von *somethings* aus der Perspektive von git abzufragen.

```{r, engine = 'bash', eval = FALSE}
[clemens@clemens_asus nnmodel]$ git status
On branch master
Your branch is up-to-date with 'origin/master'.
nothing to commit, working directory clean
```

Wir befinden uns im Master-Zweig, dessen aktueller Zustand dem im externen Repository git@github.com:nevrome/somethings.git entspricht. Bisher wurden keine Änderungen am letzten aktuellen Zustand vorgenommen.

# Modellentwicklung in R

## Bibliotheken

```{R, message = FALSE}
library(nnet)
library(dplyr)
library(quantaar)
```

- **nnet**: Feed-Forward Neural Networks and Multinomial Log-Linear Models
    - Sammlung verschiedener machine learning Algorithmen. Wir werden einen Algorithmus zur Konstruktion eines Neuronalen Netzes nutzen.
- **dplyr**: A Grammar of Data Manipulation
    - Umfassende data wrangling Funktionssammlung. Wir brauchen hier nur eine Filter- und eine Sample Funktion.
- **quantaar**: R Library for Quantitative Analysis in Archaeology
    - Sammlung von für bestimmte archäologische Anwendungen vorgesehene Methoden. Wir nutzen nur einen Testdatensatz daraus. 

## Datenvorbereitung

Datensatz *bs1* enthält eine Datentabelle für ein fiktives, Gräberfeld. Das Gräberfeld umfasst 50 Bestattungen, für die jeweils Informationen zu Geschlecht, Bestattungssitte und Beigaben vorliegen. 

```{R}
graves <- bs1

colnames(graves)
```

## Datenvorbereitung

Wir wollen uns nur auf die Relation von Geschlecht und Beigaben konzentrieren und entfernen alle anderen Attribute aus der Datensammlung.

```{R}
graves <- data.frame(graves[,-c(3,4,5,6)])

colnames(graves)
```

## Datenvorbereitung

Für die weitere Auswertung, muss die Datentabelle geringfügig umgeformt werden. Statt den Spalten *sex_male* und *sex_female*, die die fiktive anthropologische Ansprache binär kodiert enthalten **(numeric)**, benötigen wir eine Spalte, die die Informationen bündelt **(factor)**.

```{R}
sex <- as.factor(rep(0, nrow(graves)))
levels(sex) <- c("male", "female", "unknown")
for (i in 1:nrow(graves)){
  if (graves$sex_male[i] == 1){
    sex[i] <- "male"
  }
  if(graves$sex_female[i] == 1){
    sex[i] <- "female"
  } 
  if((graves$sex_male[i] == 1 && graves$sex_female[i] == 1) ||
     (graves$sex_male[i] == 0 && graves$sex_female[i] == 0)){
    sex[i] <- "unknown"
  } 
}
```

## Datenvorbereitung
```{R}
sex
```

Der erzeugte **vector** soll die ursprünglichen Spalten ersetzen. 

```{R}
graves <- data.frame(sex, graves[,-c(1,2)])
```

## Datenvorbereitung

Der Trainingsdatensatz für den Algorithmus, der unser Modell konstruieren soll, darf keine unklaren Werte enthalten. 

```{R}
graves <- filter(
  graves,
  sex != "unknown"  
)
```

Außerdem möchten wir **bootstrapping** zur Anwendung bringen, um unser Modell später validieren und kalibrieren zu können. Der Trainingsdatensatz soll also nur 30 der 40 geschlechtsbestimmten Gräber enthalten.

```{R}
graves.training <- sample_n(graves, 30)
```

## Modellentwicklung

```{R}
sex.nnet <- nnet(sex~., data = graves.training, size = 10, decay = 0)
```

## Modellentwicklung

```{r}
#summary(sex.nnet)

table(
  actual = graves$sex,
  predict = predict(sex.nnet, newdata = graves, type = "class")
)
```