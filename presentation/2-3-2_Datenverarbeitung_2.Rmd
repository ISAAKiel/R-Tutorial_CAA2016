--- 
title: "Daten verarbeiten und vorbereiten" 
author: "Dirk
Seidensticker/Clemens Schmid" 
date: "6. Februar 2016" 
fontsize: 9pt 
output: 
  beamer_presentation: 
    toc: true 
    theme: "metropolis" 
    pandoc_args: [ 
      "--highlight-style=tango" 
    ] 
fig_caption: yes 
---

# Daten verstehen und beschreiben mit R
## Pivotieren (tapply)

![](https://upload.wikimedia.org/wikipedia/commons/6/63/Pivottable-Pivoted.PNG)
\begin{small}(<https://upload.wikimedia.org/wikipedia/commons/6/63/Pivottable-Pivoted.PNG>)\end{small}

"Eine Pivot-Tabelle stellt aufgrund der verwendeten Aggregierung in den Datenfeldern die Ausgangsdaten in verdichteter, zusammengefasster Form dar." (Wikipedia)

## Pivotieren (tapply)

```{r, eval=FALSE} 
atlant <- read.csv("data/AtlantData1.csv", sep = "\t", header = TRUE)
```

```{r, echo=FALSE} 
atlant <- read.csv("C:/Users/DirkSeidenticker/Dropbox/dev/R-Tutorial_CAA2016/data/AtlantData1.csv", sep = "\t", header = TRUE)
```

## Kreuztabelle mit Auszählen

```{r} 
table(atlant$site, atlant$size)
```


## Kreuztabelle mit Auszählen

*dito mit tapply*

```{r} 
a <- tapply(atlant$qty, list(atlant$site, atlant$size), length)
a[is.na(a)] <- 0
a
```


## Berechnungen in Abhängikeit zu einer Variable

```{r} 
tapply(atlant$wt, list(atlant$site), sum)
```


## Berechnungen in Abhängikeit zu einer Variable

```{r} 
data.frame(tapply(atlant$wt, list(atlant$site), sum))
```


## Berechnungen in Abhängikeit zu einer Variable

```{r} 
data.frame(tapply(atlant$wt, list(atlant$site), 
                  function(x){sum(x)/1000}))
```


## Berechnungen in Abhängikeit zu zwei Variablen ####

```{r} 
b <- data.frame(tapply(atlant$wt, 
                list(atlant$site, atlant$size), sum), 
                check.names = FALSE)
b[is.na(b)] <- 0
b
```


## Auszählen in Abhängikeit zu drei Variablen

```{r} 
library(reshape2)

dcast(atlant, site + feature ~ size)
```


## Berechnungen in Abhängikeit zu drei Variablen

```{r} 
dcast(atlant, site + feature ~ size, 
      value.var = "wt", 
      fun.aggregate = sum)
```


## Melt
> Eingabeformat für ggplot2()!!!

Wir wollen diese vorhin erstelle Tabelle plotten:

```{r} 
a
```


## Melt

```{r} 
library(reshape2)
atlant_sites.size <- melt(a)

head(atlant_sites.size)
```


## Melt

```{r} 
colnames(atlant_sites.size) <- c('site', 'size', 'qty')

head(atlant_sites.size)

# write.table(atlant_sites.size, 
#             "data/AtlantPottey_Sites-Sizes.csv", 
#             sep = '\t')
```


## Filter und Subseting nach site 'F'

```{r} 
atlant_sub <- subset(atlant, site == 'F')
head(atlant_sub)

```


## Filter mit mehrere Bedingungen

```{r, message=FALSE} 
library(dplyr)
```

```{r} 
atlant_filter <- filter(atlant, site == 'F' & wall > 5)
head(atlant_filter)
```
